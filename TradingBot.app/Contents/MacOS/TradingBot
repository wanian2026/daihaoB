#!/bin/bash
#
# TradingBot.app 主脚本
#

# 获取.app包的路径
APP_PATH="$(dirname "$(dirname "$(dirname "${0}")")")"
PROJECT_ROOT="${APP_PATH}/../.."

# 进入项目目录
cd "${PROJECT_ROOT}"

# 获取脚本所在目录
SCRIPT_DIR="${APP_PATH}/Contents/MacOS"

# 加载配置
source "${SCRIPT_DIR}/trading_env.sh"

# 检查Python是否安装
if ! command -v python3 &> /dev/null; then
    osascript -e 'display dialog "错误: 未找到 Python3\n\n请先安装 Python 3.12 或更高版本\n下载地址: https://www.python.org/downloads/" buttons {"确定"} default button 1 with icon stop'
    exit 1
fi

# 检查虚拟环境
if [ ! -d "${PROJECT_ROOT}/.venv" ]; then
    # 创建虚拟环境
    python3 -m venv "${PROJECT_ROOT}/.venv"
fi

# 激活虚拟环境
source "${PROJECT_ROOT}/.venv/bin/activate"

# 检查依赖
if [ ! -f "${PROJECT_ROOT}/.venv/.installed" ]; then
    pip install -r "${PROJECT_ROOT}/requirements.txt"
    touch "${PROJECT_ROOT}/.venv/.installed"
fi

# 运行程序
python3 -u src/interactive/interactive_main.py
